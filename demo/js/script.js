!function(e,t){"use strict";var n={},i=function(t){var i=n[t]||e[t];if(!i)throw new Error("Requested module '"+t+"' has not been defined.");return i},o=function(t,i,o){o?e[t]=i:n[t]=i};!function(){o("$",jQuery.noConflict())}(e,t),function(){o("swts",{})}(e,t),function(){var e=function(){var t=Array.prototype.slice.call(arguments),n=t.shift(),i="";("string"==typeof n||"boolean"==typeof n)&&(i=n===!0?"deep":n,n=t.shift(),"defaults"==i&&(n=e({},n),i="strict"));for(var o=0,s=t.length;s>o;o++){var a=t[o];for(var r in a)"deep"==i&&"object"==typeof a[r]&&"undefined"!=typeof n[r]?e(i,n[r],a[r]):("strict"!=i||"strict"==i&&"undefined"!=typeof n[r])&&(n[r]=a[r])}return n};o("util/extend",e)}(e,t),function(){var e=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})};o("util/inherits",e)}(e,t),function(e,t,n){var s=i("$"),a=function(e,t,i){var o=this;i===n&&(i=t,t=n),o.confirm=!1,o.$b=s('<a href="#/'+e+(t?"/"+t:"")+'" class="swts-button"></a>').on("click",function(e){e.preventDefault(),e.stopPropagation(),o.confirm?(o.$b.removeClass("swts-button-confirm"),o.confirm=!1,i(t)):(o.$b.one("mouseout",function(){o.$b.removeClass("swts-button-confirm"),o.confirm=!1}),o.confirm=!0,o.$b.addClass("swts-button-confirm"))})};a.prototype={addClass:function(e){return this.$b.addClass(e),this},removeClass:function(e){return this.$b.removeClass(e),this},appendTo:function(e){return this.$b.appendTo(e),this},prependTo:function(e){return this.$b.prependTo(e),this},remove:function(){this.$b.remove()}},o("ui/buttons/confirm",a)}(e,t),function(e,t,n){var s=i("$"),a=i("ui/buttons/confirm"),r=function(e,t){return s('<a href="#/'+e+'" class="swts-button"></a>').on("click",function(n){n.preventDefault(),n.stopPropagation(),t(e)})},l=function(e,t){return"function"==typeof e&&(t=e,e=n),r("add"+(e?"/"+e:""),function(e){t(e?e.split("/")[1]:e)}).addClass("swts-add swts-icon-plus")},u=function(e,t){return"function"==typeof e&&(t=e,e=n),new a("remove",e,t).addClass("swts-remove swts-icon-trash")},p=function(e){return'<a href="#/remove'+(e?"/"+e:"")+'" class="swts-button swts-remove swts-icon-trash"></a>'};o("ui/buttons",{add:l,remove:u,button:r,removeTemplate:p})}(e,t),function(){var e={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"y","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sch","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"},t=function(t){return t.toLowerCase().split("").map(function(t){return e[t]||t}).join("").replace(" ","-").replace(/[^-a-z0-9]{1,60}/,"")};o("ui/input/slugify",t)}(e,t),function(e,t,n){var s=i("$"),a=i("ui/input/slugify"),r=function(e,t,i){var o=this;e instanceof s||e===n||(i=t,t=e,e=n),t||(t={}),o.$b=e||s('<label class="swts-input"><input type="'+(t.type||"text")+'" '+(t.value?'value="'+t.value+'"':"")+"><span>"+t.title+"</span></label>").on("click.input",function(e){e.stopPropagation()}),o.$i=o.$b.find("input").on("blur.input",function(){""!==this.value?o.$b.addClass("swts-input-val"):o.$b.removeClass("swts-input-val")}).trigger("blur").on("keyup.input",function(){o.transform&&(this.value=o.transform(this.value)),o.throttledUpdate(this.value)}),o.value=t.value,o.rx=t.rx,t.slugify?(o.slugify=!0,o.transform=a):t.transform&&(o.transform=t.transform),o.err=t.errorClass||"swts-error",o.cb=i,t.onPaste&&o.$i.on("paste",t.onPaste)};r.prototype={val:function(e){return e===n?this.$i.val():(this.$i.val(e).trigger("blur"),this.throttledUpdate(e),this)},focus:function(){this.$i.focus()},throttledUpdate:function(e){var t=this;clearTimeout(t.typingTimer),t.typingTimer=setTimeout(function(){e!==t.value&&(t.rx?t.rx.test(e)?t.update(e):t.$b.addClass(t.err):t.update(e))},300)},update:function(e){var t=this;t.$b.removeClass(t.err),t.value=e,t.cb&&t.cb(e)},addClass:function(e){return this.$b.addClass(e),this},removeClass:function(e){return this.$b.removeClass(e),this},appendTo:function(e){return this.$b.appendTo(e),this},prependTo:function(e){return this.$b.prependTo(e),this},remove:function(){this.$i.off(".input"),this.$b.off(".input").remove()}},o("ui/input",r)}(e,t),function(){var e=(i("$"),i("ui/input"));o("ui/nipple/input",function(t,n,i){return new e(n,i)})}(e,t),function(e,t,n){var s=i("$"),a=function(e,t){var i=this,o=0,a="";for(var r in t)if("item"!==r){var l=t[r];o++,a+='<a href="#/'+(l.confirm?"confirm/":"")+r+'" class="'+l.icon+'" '+(l.title?'title="'+l.title+'"':"")+"></a>"}i.active=n,i.confirm=n,i.$b=s(a).hover(function(){i.active=this.hash.split("/")[1],i.$parent.addClass("nipple-h-"+i.active),i.$b.not(this).addClass("nipple-hidden")},function(){i.$parent.removeClass("nipple-h-"+i.active),i.$b.removeClass("nipple-hidden")}),setTimeout(function(){i.$parent=i.$b.first().parent().addClass("nipple-i-tools-"+o).on("mouseout.nipple-confirm",function(){i.hideConfirm()}).on("click.nipple-confirm","a",function(e){i.confirm&&i.$parent.hasClass("nipple-confirmation")?setTimeout(function(){i.hideConfirm()},0):"#/confirm"===this.hash.substring(0,9)&&(e.preventDefault(),e.stopPropagation(),i.showConfirm(this))})},0)};a.prototype={showConfirm:function(e){this.$confirm=s(e),this.$parent.addClass("nipple-confirmation"),this.confirm=this.$confirm.attr("href").slice(9),this.$confirm.attr("href","#"+this.confirm)},hideConfirm:function(){this.confirm&&(this.$confirm.attr("href","#/confirm"+this.confirm),this.$parent.removeClass("nipple-confirmation"),this.confirm=n)},remove:function(){this.$parent.off(".nipple-confirm")}},o("ui/nipple/tools",function(e,t){return new a(e,t)})}(e,t),function(e,t,n){var s,a,r=i("$");r(t).on("click.nipple",function(){s&&s.hide()});var l={input:i("ui/nipple/input"),tools:i("ui/nipple/tools"),item:function(e,t){return{$b:r('<a href="#/'+e+'">'+t.title+"</a>")}}},u=function(e,t){var i=this;t===n&&(t=e,e={}),i._popup=e.popup||a.popup||"s",i.autoHide=e.autoHide||a.autoHide,i.menu=e.menu||a.menu,i.cbs=t,i.items={},i.active=!1,i.build(e.items||a.items,e.size||a.size||"small")};u.prototype={build:function(e,t){var n=this,i=n.cbs,o=r('<ul class="nipple-items"></ul>').on("click.nipple","a",function(e){e.preventDefault(),e.stopPropagation();var t=this.hash.split("/");n.autoHide&&n.hide(),!n.menu&&r(this).parent().hasClass("nipple-i-item")&&n.val(this.hash.slice(2)),i[t[1]]&&i[t[1]].apply(n,t.slice(2))});for(var s in e){var a,u=e[s],p=u.item||"item",c=r('<li class="nipple-i-'+p+'"></li>');a=l[p](s,e[s],i[s]&&i[s].bind(n)),c.append(a.$b),o.append(c),n.items[s]=a}n.$b=r('<div class="nipple nipple-'+t+" nipple-"+n._popup+'"><a href="#nipple-open"></a></div>').append(o),n.$a=n.$b.children("a").on("click.nipple",function(e){e.preventDefault(),e.stopPropagation(),n.toggle()}),n.$items=n.$b.find(".nipple-i-item")},val:function(e){return e===n?this._val:(this._val!==e&&(this.menu||this.$items.find('[href="#/'+this._val+'"]').parent().removeClass("nipple-selected").end().end().find('[href="#/'+e+'"]').parent().addClass("nipple-selected"),this._val=e),this)},direction:function(e){return e===n?this._popup:(this._popup!==e&&(this.$b.removeClass("nipple-"+this._popup).addClass("nipple-"+e),this._popup=e),this)},confirm:function(e){var t=this;t.confirmTool!==e?t.$confirm.attr("href","#/confirm/"+e).addClass("nipple-hot"):(t.cbs[e].apply(t,arguments.slice(1)),t.hideConfirm())},hideConfirm:function(){this.confirmTool=n,this.$confirm.removeClass("nipple-hot")},toggle:function(){this.active?this.hide():this.show()},show:function(){return s&&s.hide(),s=this,this.$b.addClass("nipple-hot"),this.active=!0,this},hide:function(){return s=n,this.$b.removeClass("nipple-hot"),this.active=!1,this},addClass:function(e){return this.$b.addClass(e),this},removeClass:function(e){return this.$b.removeClass(e),this},appendTo:function(e){return this.$b.appendTo(e),this},prependTo:function(e){return this.$b.prependTo(e),this},remove:function(){this.$b.remove()}},u.defaults=function(e){a=e},o("ui/nipple",u)}(e,t),function(e,t,n){var s=i("$"),a=s(e),r=i("swts"),l=i("ui/nipple"),u=i("ui/input"),p='<div class="swts-cover-login"><label class="swts-input" id="swts-cover-email"><input type="text"><span>Email</span></label><label class="swts-input" id="swts-cover-password"><input type="password"><span>Password</span></label><a href="#/login" class="swts-button">Go</a></div>',c=function(e){var t=this;e||(e={}),t.$parent=s(e.parent||"body"),t.isLoginVisible=!1,t.editing=!1,t.popup=e.popup||"n",t.ui={},r.u?t.showUser(r.u):t.buildLogin()};c.prototype={load:function(){var n=this,i=t.createElement("script");o("swts",r,!0),i.src="/static/js/chocolate.js",i.onload=function(){e.Chocolate&&(n.choco=new e.Chocolate(r),n.choco.on(),n.edit())},t.body.appendChild(i)},buildLogin:function(){var e=this;e.$l=s(p).appendTo(e.$parent).on("click.swts.login",function(e){e.stopPropagation()}).on("keypress.swts.login",function(t){13===t.keyCode&&e.login()}).find(".swts-button").on("click.swts.login",function(t){t.preventDefault(),e.login()}).end(),e.ui.login=new u(e.$l.find("#swts-cover-email")),e.ui.password=new u(e.$l.find("#swts-cover-password")),a.on({"keydown.swts.login":function(t){e.isLoginVisible?27===t.keyCode&&(t.preventDefault(),e.hideLogin()):t.shiftKey&&48===t.keyCode&&(t.preventDefault(),e.showLogin())},"click.swts.login":function(){e.isLoginVisible&&e.hideLogin()}})},showLogin:function(){this.isLoginVisible=!0,this.$l.addClass("active"),this.ui.login.focus()},hideLogin:function(){this.$l.removeClass("active"),this.ui.login.val(""),this.ui.password.val(""),this.isLoginVisible=!1},removeLogin:function(){var e=this;e.hideLogin(),a.off(".swts.login"),setTimeout(function(){e.$l.remove(),e.ui.login=n,e.ui.password=n},650)},login:function(){var e=this,t=e.ui;r.userLogin(t.login.val(),t.password.val(),function(t,n){t?e.error():(e.removeLogin(),e.showUser(n))})},error:function(){var e=this;e.$l.addClass("swts-error"),setTimeout(function(){e.$l.removeClass("swts-error")},500)},showUser:function(e){if(e){var t=this;t.ui.user=new l({popup:t.popup,size:"medium",menu:!0,autoHide:!0,items:{edit:{title:"Edit"},profile:{title:e.name||e.id},logout:{title:"Logout"}}},{edit:t.edit.bind(t),logout:t.logout.bind(t),profile:function(){console.log("User profile")}}).addClass("swts-user").appendTo(t.$parent)}},edit:function(){var e=this,t=e.ui.user;e.choco?e.editing?(e.editing=!1,e.choco.off(),t.removeClass("swts-editing").items.edit.$b.text("Edit")):(e.choco.on(),t.addClass("swts-editing").items.edit.$b.text("Stop editing"),e.editing=!0):e.load()},logout:function(){r.userLogout(),this.ui.user.remove(),this.ui={},this.buildLogin()}},o("ui/cover",c)}(e,t),function(e,t,n){var s=i("$"),a=/(\/)/g,r=function(e,t,n){var i=this;"function"==typeof t&&(n=t,t={}),i.keepOrder=t.keepOrder,i.isMultiple=t.multiple,i.selected=t.selected||(i.isMultiple?[]:""),i.cb=n,i.items=e,i.order=[],i.build()};r.prototype={parse:function(){return this},buildItems:function(e){for(var t=this,n="",i=t.selected,o=i&&i.length,s=0,r=e.length;r>s;s++){var l="",u=e[s],p=Object.keys(u)[0];t.order.push(p),o?(p===i||t.isMultiple&&-1!==i.indexOf(p))&&(l=" selectah-active"):0===s&&(l=" selectah-active");var c=p.match(a);n+='<li class="selectah-level-'+(c?c.length:0)+l+'"><a href="#:'+p+'">'+u[p]+"</a></li>"}return n},build:function(){var e=this,t='<ul class="selectah">';t+=e.buildItems(e.items),t+="</ul>",e.$b=s(t).on("click.selectah","a",function(t){t.preventDefault(),t.stopPropagation(),e.check(this)}),e.$li=e.$b.find("li")},pushInOrder:function(e){var t=this,n=t.order,i=t.selected;for(e=e.split("/");e.length;){var o=e.join("/");i.push(o),this.$b.find('a[href="#:'+o+'"]').parent().addClass("selectah-active"),e.pop()}t.selected=[];for(var s in n)-1!==i.indexOf(n[s])&&t.selected.push(n[s])},set:function(e){var t=this;return t.selected=e,t.$b.addClass("no-transition"),t.$li.removeClass("selectah-active"),t.$b.find('a[href="#:'+e+'"]').parent().addClass("selectah-active"),setTimeout(function(){t.$b.removeClass("no-transition")},10),this},val:function(e){return e===n?this.selected:(this.check(this.$b.find('a[href="#:'+e+'"]')[0]),this)},check:function(e){var t=this,n=e.hash.split(":")[1],i=s(e).parent();i.hasClass("selectah-active")?t.deactivate(i,n):t.activate(i,n)},activate:function(e,t){var n=this;n.isMultiple?n.keepOrder?n.pushInOrder(t):n.selected.push(t):(n.$li.removeClass("selectah-active"),n.selected=t),e.addClass("selectah-active"),n.cb&&n.cb(n.selected)},deactivate:function(e,t){var n=this;if(n.isMultiple&&n.selected.length>1){e.removeClass("selectah-active");for(var i=0;i<n.selected.length;i++)if(n.selected[i]===t){n.selected.splice(i,1);break}n.cb&&n.cb(n.selected)}},show:function(){return this.$b.show(),this},addClass:function(e){return this.$b.addClass(e),this},removeClass:function(e){return this.$b.removeClass(e),this},appendTo:function(e){return this.$b.appendTo(e),this},prependTo:function(e){return this.$b.prependTo(e),this},remove:function(){var e=this;e.$b.off(".selectah"),e.$b.remove()}},o("ui/selectah",r)}(e,t),function(e,t,n){var s=i("$"),a=[31,28,31,30,31,30,31,31,30,31,30,31],r={startDay:"MON",messages:{year:"",months:{0:{s:"Jan",f:"January"},1:{s:"Feb",f:"February"},2:{s:"Mar",f:"March"},3:{s:"Apr",f:"April"},4:{s:"May",f:"May"},5:{s:"Jun",f:"June"},6:{s:"Jul",f:"July"},7:{s:"Aug",f:"August"},8:{s:"Sep",f:"September"},9:{s:"Oct",f:"October"},10:{s:"Nov",f:"November"},11:{s:"Dec",f:"December"}}}},l=function(e,t){"function"==typeof e&&(t=e,e={});var n=this;n.$b=s("<div class='gregory'></div>"),n.modes={day:"day",month:"month",year:"year"},n.displayState={},n.selectedState={},n.prevFullState={},n.weekStartDay=e.weekStartDay||r.startDay,n.messages=e.messages||r.messages,n.flip=e.flip,n.cb=t,n.build(e.popup),n.prevFullState.mode=n.modes.day};l.prototype={build:function(e){var t=this,n=t.flip,i='<div class="gregory-header"><a class="gregory-change gregory-back" href="#"></a><a class="gregory-info" href="#/"></a><a class="gregory-change gregory-forward" href="#"></a></div>',o='<div class="gregory'+(e?" gregory-popup":"")+(n?" gregory-up":" gregory-down")+'">';n||(o+=i),o+='<div class="gregory-wrapper"></div>',n&&(o+=i),o+="</div>",t.$b=s(o).on("click.gregory",function(e){e.stopPropagation()}).on("click.gregory","a.gregory-change",function(e){e.preventDefault();var n=this.hash.split("/"),i=parseInt(n[1],10),o=n[2]?parseInt(n[2],10):null,s={};s.year=i,(0===o||o)&&(s.month=o),t.changeDisplayState(s,"dateChange")}),t.$wrapper=t.$b.find(".gregory-wrapper").on("click.gregory","a",function(e){e.preventDefault();var n=s(this),i=this.hash.split("/"),o=parseInt(i[1],10),a=i[2]?parseInt(i[2],10):null,r=i[3]?parseInt(i[3],10):null;t.changeSelectedState({year:o,month:a,day:r},n),t.cb&&t.cb(new Date(o,a,r),!!r)}),t.$date=t.$b.find(".gregory-info").on("click.gregory",function(e){e.preventDefault();var n={};n.mode=this.hash.split("/")[1],n.mode===t.modes.day?t.changeSelectedState(t.prevFullState):(n.month=null===t.displayState.month?t.selectedState.month:t.displayState.month,t.isYearActive(t.displayState.year)||t.displayState.mode!==t.modes.month||(n.year=t.selectedState.year),t.changeDisplayState(n))}),t.$back=t.$b.find(".gregory-back"),t.$forward=t.$b.find(".gregory-forward")},val:function(e){if(e===n){var t=this.selectedState;return new Date(t.year,t.month,t.day)}var i;return i=e instanceof Date?{year:e.getFullYear(),month:e.getMonth(),day:e.getDate()}:e,i.mode=i.day?this.modes.day:this.modes.month,this.changeDisplayState(i),this.changeSelectedState(i),this},changeDisplayState:function(e){var t=this;t.setDisplayState(e),t.generateCalendar(),t.updateInfo()},changeSelectedState:function(e,t){var n=this;if(n.displayState.mode===n.modes.day){if(n.$wrapper.find(".gregory-active").removeClass("gregory-active"),!t){var i="a[href='#/"+e.year+(0===e.month||e.month?"/"+e.month+(e.day?"/"+e.day:""):"")+"']";t=n.$wrapper.find(i)}t.addClass("gregory-active")}n.setSelectedState(e),n.updatePrevFullState(),e.mode||(n.displayState.mode===n.modes.year?e.mode=n.modes.month:n.displayState.mode===n.modes.month&&(e.mode=n.modes.day)),n.changeDisplayState(e)},generateCalendar:function(){var e=this;e.displayState.mode===e.modes.day?e.generateDayCalendar():e.displayState.mode===e.modes.month?e.generateMonthCalendar():e.generateYearCalendar()},generateDayCalendar:function(){var e=this,t=new Date(e.displayState.year,e.displayState.month,1).getDay(),n=e.getDaysInMonth(e.displayState.year,e.displayState.month),i="MON"===e.weekStartDay?0===t?6:t-1:t,o='<ul class="gregory-day">',s=1,a=e.decrementMonth(e.displayState.year,e.displayState.month),r=e.incrementMonth(e.displayState.year,e.displayState.month);e.setChange(a.year+"/"+a.month,r.year+"/"+r.month);for(var l=0;9>l;l++){for(var u=0;6>=u;u++)if(n>=s&&(u>=i&&0===l||l>0))o+="<li><a class='"+(e.isDayActive(s)?"gregory-active":"")+"' href='#/"+e.displayState.year+"/"+e.displayState.month+"/"+s+"'>"+s+"</a></li>",s++;else{if(s>n)break;o+="<li></li>"}if(s>n)break}o+="</ul>",e.$wrapper.html(o)},generateMonthCalendar:function(){var e=this,t='<ul class="gregory-month">',n=0;e.setChange(e.displayState.year-1,e.displayState.year+1);for(var i=0;4>i;i++){for(var o=0;2>=o;o++)t+="<li><a class='"+(e.isMonthActive(n)?"gregory-active'":"")+"' href='#/"+e.displayState.year+"/"+n+"'>"+e.messages.months[n].s+"</a></li>",n++;if(n>11)break}t+="</ul>",e.$wrapper.html(t)},generateYearCalendar:function(){var e=this,t='<ul class="gregory-year">',n=e.displayState.twelfth-11;e.setChange(n-1,e.displayState.twelfth+12);for(var i=0;4>i;i++){for(var o=0;2>=o;o++)t+="<li><a class='"+(e.isYearActive(n)?"gregory-active'":"")+"' href='#/"+n+"'>"+n+"</a></li>",n++;if(n>e.displayState.twelfth)break}t+="</ul>",e.$wrapper.html(t)},setChange:function(e,t){var n=this;n.$back.attr("href","#/"+e),n.$forward.attr("href","#/"+t)},setDateActive:function(){var e=this;e.$wrapper.find("a[href='#/"+e.formUrl+"']").addClass("gregory-active")},decrementMonth:function(e,t){var n={};return 0===t?(n.year=e-1,n.month=11):(n.year=e,n.month=t-1),n},incrementMonth:function(e,t){var n={};return 11===t?(n.year=e+1,n.month=0):(n.year=e,n.month=t+1),n},getDaysInMonth:function(){var e=this;return 1===e.displayState.month&&(e.displayState.year%4===0&&e.displayState.year%100!==0||e.displayState.year%400===0)?29:a[e.displayState.month]},updateInfo:function(){var e,t=this,n=t.displayState;t.$date.html(n.mode===t.modes.day?t.messages.months[n.month].f+" "+n.year:n.mode===t.modes.month?n.year+" "+t.messages.year:t.prevFullState.day+"."+(t.prevFullState.month+1)+"."+t.prevFullState.year),n.mode===t.modes.day?e=t.modes.month:n.mode===t.modes.month?e=t.modes.year:n.mode===t.modes.year&&(e=t.modes.day),t.$date.attr("href","#/"+e)},setDisplayState:function(e){var t=this,n=t.displayState;e.year&&(n.year=e.year,n.twelfth=e.year),n.month=0===e.month||e.month?e.month:null,e.mode&&(n.mode=e.mode),n.mode||(n.mode=0===e.month||e.month?t.modes.day:t.modes.month)},setSelectedState:function(e){var t=this.selectedState;t.year=e.year,t.month=e.month,t.day=e.day?e.day:null},updatePrevFullState:function(){var e=this.selectedState,t=this.prevFullState;e.day&&(e.month||0===e.month)&&e.year&&(t.day=e.day,t.month=e.month,t.year=e.year)},isDayActive:function(e){return e===this.selectedState.day&&this.displayState.month===this.selectedState.month&&this.displayState.year===this.selectedState.year},isMonthActive:function(e){return e===this.selectedState.month&&this.displayState.year===this.selectedState.year},isYearActive:function(e){return e===this.selectedState.year},show:function(){return this.$b.addClass("gregory-hot"),this},hide:function(){return this.$b.removeClass("gregory-hot"),this},toggle:function(){return this.$b.toggleClass("gregory-hot"),this},addClass:function(e){return this.$b.addClass(e),this},removeClass:function(e){return this.$b.removeClass(e),this},appendTo:function(e){return this.$b.appendTo(e),this},prependTo:function(e){return this.$b.prependTo(e),this},remove:function(){var e=this;e.$b.off(".gregory"),e.$b.remove()}},l.defaults=function(e){r=e},o("ui/gregory",l)}(e,t),function(e,t,n){var s,a=i("$"),r=i("util/inherits"),l=i("ui/input"),u=i("ui/gregory"),p=a(t),c=/^\d{1,2}.\d{1,2}.\d{4}$/,d=function(e,t,i){var o=this;e instanceof a||(i=t,t=e,e=n),t||(t={}),t.rx||(t.rx=c),t.type="text",l.call(o,e,t),o.flip=t.flip,o.cb=i,this.active=!1,o.gregory=new u({flip:o.flip,popup:!0},function(e,t){t&&o.update(e)}).appendTo(o.$b),o.$i.on("click.input",function(){o.toggle()}),p.on("click.input",function(){o.active&&o.hide()});var s=1e3*parseInt(o.$i.val(),10);s===s?o.val(s,!0):o.gregory.val(new Date)};r(d,l),d.prototype.val2date=function(e){var t;switch(typeof e){case"number":t=new Date(e);break;case"string":e=e.split("."),t=new Date(e[2],e[1]-1,e[0]);break;default:t=e}return t&&"Invalid Date"===t.toString()?n:t},d.prototype.show=function(){return s&&s.hide(),s=this.gregory.show(),this.active=!0,this},d.prototype.hide=function(){return s=n,this.gregory.hide(),this.active=!1,this},d.prototype.toggle=function(){this.active?this.hide():this.show()},d.prototype.formatDate=function(e){return e.getDate()+"."+(e.getMonth()+1)+"."+e.getFullYear()},d.prototype.val=function(e){return e===n?this.value:(this.update(e),this)},d.prototype.update=function(e,t){var i=this,o=function(e){i.$b.removeClass(i.err),i.gregory.val(e),i.value=i.gregory.val(),i.$i.val(i.formatDate(e)).trigger("blur"),!t&&i.cb&&i.cb(e)};e=i.val2date(e),i.value===n&&e?o(e):e&&i.value.getTime()!==e.getTime()&&o(e)},d.prototype.remove=function(){var e=this;s===this.gregory&&(s=n),e.gregory.remove(),e.$i.off(".input"),e.$b.off(".input").remove()},o("ui/gregory/dateinput",d)}(e,t),function(e,t){var n=i("$"),s=(n(e),n("body")),a=[],r=function(){for(var e in a)a[e].addClass("gutenberg-hidden")},l=function(e){for(var t in a)e===a[t]&&a.splice(t,1)},u={bold:{icon:"swts-icon-bold",command:function(e){t.execCommand("bold"),e.onTextEdit(e.$b.html())}},removeFormat:{icon:"swts-icon-clean",command:function(e){t.execCommand("removeFormat"),e.onTextEdit(e.$b.html())}},italic:{icon:"swts-icon-italic",command:function(e){t.execCommand("italic"),e.onTextEdit(e.$b.html())}},link:{icon:"swts-icon-link",iconUnlink:"swts-icon-unlink",additionalInit:function(i){i.selectionIsLink=function(){var t=!1,n=e.getSelection();return(navigator.userAgent.match(/webkit/i)?0:1)?(navigator.userAgent.match(/firefox/i)?0:1)||(t=i.firefoxSelectionIsLink()):t=i.findNodeWithTags(n.focusNode,"A"),t},i.firefoxSelectionIsLink=function(){var t=e.getSelection(),n=i.getRange(),o=n.cloneContents();return 1===o.childNodes.length&&"A"===o.firstChild.tagName?!0:i.findNodeWithTags(t.focusNode,"A")},i.findNodeWithTags=function(e,t){for(n.isArray(t)||(t=[t]);e;){if(3!==e.nodeType){var i=t.indexOf(e.tagName);if(-1!==i)return e}e=e.parentNode}return null},i.buildLink=function(){i.$link=i.$controlsWrapper.find("a.swts-icon-link"),i.$linkWrapper=n('<li class="gutenberg-hidden"><input type="text" placeholder="Type link here"/></li>'),i.$linkInput=i.$linkWrapper.find("input"),i.$link.parent().parent().append(i.$linkWrapper)},i.initLinkListeners=function(){i.$linkInput.on("keypress",function(e){13===e.which&&i.onLinkEnter()}),i.$b.on("mousedown.gutenberg",function(){i.hide(i.$linkWrapper,!0),n(t).one("mousedown.gutenberg",function(){i.hide(i.$linkWrapper,!0)}).one("mouseup.gutenberg",function(){i.clicked&&i.selectionIsLink()?i.$link.removeClass("swts-icon-link").addClass("swts-icon-unlink"):i.clicked&&!i.selectionIsLink()&&i.$link.removeClass("swts-icon-unlink").addClass("swts-icon-link")})})},i.onLinkEnter=function(){var n=e.getSelection();i.$linkInput.blur(),n.removeAllRanges(),n.addRange(i.$linkInput.data("selection")),t.execCommand("createlink",!1,i.$linkInput.val()),i.hide(i.$linkWrapper,!0),i.$link.removeClass("swts-icon-link").addClass("swts-icon-unlink"),i.onTextEdit(i.$b.html())},i.buildLink(),i.initLinkListeners()},command:function(n){n.selectionIsLink()?(t.execCommand("unlink"),n.$link.removeClass("swts-icon-unlink").addClass("swts-icon-link"),n.onTextEdit(n.$b.html())):(n.$linkInput.data("selection",e.getSelection().getRangeAt(0)),n.hide(n.$linkWrapper,!1),n.$linkInput.focus())}}},p=function(e,t,i){var o=this;"function"==typeof t&&(i=t,t={}),o.$b=n(e),o.$controlsWrapper,o.$links,o.initialVal=o.$b.html(),o.tempVal,o.commands=t.commands,o.onChange=i,o.onChangeDelay=t.onChangeDelay||1e3,o.stopLinks=t.stopLinks,o.typingTimer,o.init()};p.prototype.init=function(){var e=this;e.$b.attr("contenteditable",!0),e.buildDOM(),e.initListeners()},p.prototype.buildDOM=function(){var e,t=this;if(t.commands){t.$controlsWrapper=n('<ul class="gutenberg-ctrl gutenberg-hidden">'),s.append(t.$controlsWrapper),a.push(t.$controlsWrapper);for(var i in t.commands){var o=t.commands[i],r=u[o];r&&(e='<li><a href="#'+o+'" class="'+r.icon+'"></a></li>',t.$controlsWrapper.append(e),r.additionalInit&&r.additionalInit(t))}t.$links=t.$controlsWrapper.find("a")}},p.prototype.initListeners=function(){var e=this;e.$b.on("paste.gutenberg",function(t){e.onPaste(this,t)}).on("keydown.gutenberg",function(t){27===t.which?e.restoreText():8===t.which&&setTimeout(function(){e.sanitizeBackspace()},2)}).on("keyup.gutenberg",function(){e.onTextEdit(e.$b.html())}).on("mousedown.gutenberg",function(i){e.clicked=!0,i.stopPropagation(),r(),n(t).one("mousedown.gutenberg",function(){r()}).one("mouseup.gutenberg",function(t){e.onTextSelect(t)})}).on("focus.gutenberg",function(){e.tempVal=e.$b.html()}),e.stopLinks&&e.$b.on("click",function(e){e.preventDefault(),e.stopPropagation()}),e.$controlsWrapper&&(e.$controlsWrapper.on("mousedown.gutenberg",function(e){e.stopPropagation()}).on("mouseup.gutenberg",function(e){e.stopPropagation()}),e.$controlsWrapper.on("click.gutenberg","a",function(t){t.preventDefault(),e.onToolClick(this.href.split("#")[1])}))},p.prototype.onPaste=function(e,n){var i=this;t.execCommand("insertText",!1,n.originalEvent.clipboardData.getData("text/plain")),n.preventDefault(),n.stopPropagation(),i.onTextEdit(i.$b.html())},p.prototype.sanitizeBackspace=function(){var e=this;e.$b.find("span").each(function(){this.style&&n(this).contents().unwrap()})},p.prototype.onTextSelect=function(e){var t=this,n=t.getRange();if(t.$controlsWrapper&&n.startOffset!==n.endOffset&&t.clicked){if(t.prevStartOffset===n.startOffset&&t.prevEndOffset===n.endOffset)return void t.hide(t.$controlsWrapper,!0);t.hide(t.$controlsWrapper,!1);var i=t.getSelectionPosition(e);t.$controlsWrapper.css({left:i.left,top:i.top}),t.clicked=!0,t.prevStartOffset=n.startOffset,t.prevEndOffset=n.endOffset}},p.prototype.onToolClick=function(e){u[e].command(this)},p.prototype.onTextEdit=function(e){var t=this;clearTimeout(t.typingTimer),t.typingTimer=setTimeout(function(){t.updateContent(e)},t.onChangeDelay)},p.prototype.updateContent=function(e){this.tempVal!==e&&(this.onChange(e),this.tempVal=e)},p.prototype.restoreText=function(){var e=this;e.$b.html(e.initialVal),e.onTextEdit(e.initialVal)},p.prototype.val=function(e){this.$b.html(e)},p.prototype.getRange=function(){if(e.getSelection){var n=e.getSelection();if(n.rangeCount>0)return n.getRangeAt(0)}else if(t.selection&&t.selection.createRange)return t.selection.createRange();return null},p.prototype.getSelectionPosition=function(e){var n=this,i=n.getRange().getBoundingClientRect(),o=e.pageX-n.$controlsWrapper.width()/2,s=t.body.scrollTop||t.documentElement.scrollTop;0>o&&(o=10);var a=s+i.top-n.$controlsWrapper.height()-10;return{left:o,top:a}},p.prototype.remove=function(){var e=this;e.$b.off(".gutenberg"),e.$b.attr("contenteditable",!1),e.$controlsWrapper&&e.$controlsWrapper.remove(),l(e.$controlsWrapper)},p.prototype.hide=function(e,t){t?e.addClass("gutenberg-hidden"):e.removeClass("gutenberg-hidden")},o("ui/gutenberg",p)}(e,t),function(e,t,n){var s,a=i("$"),r=i("swts"),l=function(e,t,i){var o=this;o.$b=a(e),o.$progress=a('<div class="swts-upload-progress"></div>'),o.delay=i.progressDelay||500,o.resource=t,o.start=i.start,o.done=i.done,o.progress=i.progress,o.maxFiles=i.maxFiles||1,o.$b.on({"dragover.upload":function(){return s&&s.removeClass("swts-upload-drop"),s=o.$b.addClass("swts-upload-drop"),!1},"drop.upload":function(e){e.preventDefault(),o.$b.removeClass("swts-upload-drop"),s=n;var t=e.originalEvent.dataTransfer.files;t.length&&t.length<=o.maxFiles&&o.upload(t,e.target)},"mouseout.upload":function(){o.$b.removeClass("swts-upload-drop"),s=n}})};l.prototype.upload=function(e,t){var n=this,i={resource:"file",method:"create",body:{resource:n.resource},files:e,onprogress:function(e){var t=e.loaded/e.total*100;n.$progress.css("width",t+"%"),n.progress&&n.progress(e,t)}};n.$b.append(n.$progress),n.startTimeout=setTimeout(function(){n.$progress.addClass("uploading")},n.delay),n.start&&n.start(),r.c(i,function(e,i){clearTimeout(n.startTimeout),n.$progress.removeClass("uploading"),setTimeout(function(){n.$progress.detach()},n.delay),n.done(e,i,t)})},l.prototype.remove=function(){var e=this;e.$b.off(".upload")},o("ui/upload",l)}(e,t),function(e,t){var n=i("$"),o=i("ui/buttons"),s=i("ui/nipple"),a=i("ui/input"),r=i("ui/cover"),l=i("ui/selectah"),u=i("ui/gregory"),p=i("ui/gregory/dateinput"),c=i("ui/gutenberg"),d=i("ui/upload");n(t).ready(function(){s.defaults({items:{tools:{item:"tools",options:{title:"Options",icon:"swts-icon-dots"},remove:{confirm:!0,title:"Удалить",icon:"swts-icon-trash"}},"status/draft":{title:"Draft"},"status/published":{title:"Published"}}});{var e=(o.add("id",function(e){console.log("add button",e)}).appendTo("#simple-buttons"),o.remove("id",function(e){console.log("remove button",e)}).appendTo("#simple-buttons"),new a({title:"Title"},function(e){console.log("Input",e)}).appendTo("#input-fields"),new a({title:"Slug",slugify:!0},function(e){console.log("Slug",e)}).appendTo("#input-fields"),/^\d{2,20}$/),t=/^https?:\/\/(?:www\.)?vimeo.com\/(\d+)($|\/)/;new a({title:"Vimeo id",rx:e,onPaste:function(){var e=this;setTimeout(function(){var n=e.value.match(t);n&&(e.value=n[1])},32)}},function(e){console.log("Vimeo Id",e)}).appendTo("#input-fields"),new r("body"),new s({popup:"e",size:"medium",menu:!0,autoHide:!0,items:{edit:{title:"Edit"},profile:{title:"Username"},logout:{title:"Logout"}}},{edit:function(){console.log("Edit mode")},profile:function(){console.log("User profile")},logout:function(){console.log("Logout")}}).addClass("swts-user").appendTo("#nipple"),new s({status:function(e){console.log("Nipple status",e),this.removeClass("draft published").addClass(e)},remove:function(){console.log("Nipple remove")},options:function(){console.log("Nipple options")}}).val("status/draft").addClass("draft").appendTo("#nipple"),new s({popup:"n",items:{slug:{item:"input",title:"Slug",slugify:!0},title:{item:"input",title:"Title",value:"Item title"}}},{slug:function(e){console.log("slug",e)},title:function(e){console.log("title",e)}}).addClass("swts-options").appendTo("#nipple"),new l([{draft:"Draft"},{ready:"Ready"},{published:"Published"}],function(e){console.log("Selectah",e)}).addClass("simple").appendTo("#selectah"),new l([{app:"Application"},{code:"Code"},{design:"Design"},{photography:"Photography"},{web:"Web"}],{multiple:!0,keepOrder:!0,selected:["app","design"]},function(e){console.log("Selectah",e)}).addClass("multi").appendTo("#selectah"),new u(function(e){console.log("Gregory",e)}).val(new Date).appendTo("#gregory"),new p({title:"Publication date"},function(e){console.log("Date input",e)}).appendTo("#dateinput"),new c("#gutenberg > p",function(e){console.log("Gutenberg",e)}),new d("#upload","sponsor",{maxFiles:1,start:function(){console.log("Upload start")},progress:function(e,t){console.log("Upload progress",t)},done:function(e,t,n){console.log("Upload done",e,t,n)}})}})}(e,t)}(window,document);