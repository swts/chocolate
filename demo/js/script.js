!function(t,e){"use strict";var o={},n=function(e){var n=o[e]||t[e];if(!n)throw new Error("Requested module '"+e+"' has not been defined.");return n},i=function(e,n,i){i?t[e]=n:o[e]=n};!function(){i("$",jQuery.noConflict())}(t,e),function(){i("swts",{})}(t,e),function(){var t=function(){var e=Array.prototype.slice.call(arguments),o=e.shift(),n="";("string"==typeof o||"boolean"==typeof o)&&(n=o===!0?"deep":o,o=e.shift(),"defaults"==n&&(o=t({},o),n="strict"));for(var i=0,s=e.length;s>i;i++){var r=e[i];for(var a in r)"deep"==n&&"object"==typeof r[a]&&"undefined"!=typeof o[a]?t(n,o[a],r[a]):("strict"!=n||"strict"==n&&"undefined"!=typeof o[a])&&(o[a]=r[a])}return o};i("util/extend",t)}(t,e),function(){var t=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})};i("util/inherits",t)}(t,e),function(t,e,o){var n=["css","addClass","removeClass","toggleClass","appendTo","prependTo","insertBefore","insertAfter"],s=function(){};s.prototype={remove:function(t){t&&this.$b.off(t),this.$b.remove(),this.$b=o}},n.forEach(function(t){s.prototype[t]=function(){return this.$b[t].apply(this.$b,arguments),this}}),i("ui/bar",s)}(t,e),function(t,e,o){var s=n("$"),r=function(t,e,n){var i=this;n===o&&(n=e,e=o),i.confirm=!1,i.$b=s('<a href="#/'+t+(e?"/"+e:"")+'" class="swts-button"></a>').on("click",function(t){t.preventDefault(),t.stopPropagation(),i.confirm?(i.$b.removeClass("swts-button-confirm"),i.confirm=!1,n(e)):(i.$b.one("mouseout",function(){i.$b.removeClass("swts-button-confirm"),i.confirm=!1}),i.confirm=!0,i.$b.addClass("swts-button-confirm"))})};r.prototype={addClass:function(t){return this.$b.addClass(t),this},removeClass:function(t){return this.$b.removeClass(t),this},appendTo:function(t){return this.$b.appendTo(t),this},prependTo:function(t){return this.$b.prependTo(t),this},remove:function(){this.$b.remove()}},i("ui/buttons/confirm",r)}(t,e),function(t,e,o){var s=n("$"),r=n("ui/buttons/confirm"),a=function(t,e){return s('<a href="#/'+t+'" class="swts-button"></a>').on("click",function(o){o.preventDefault(),o.stopPropagation(),e(t)})},l=function(t,e){return"function"==typeof t&&(e=t,t=o),a("add"+(t?"/"+t:""),function(t){e(t?t.split("/")[1]:t)}).addClass("swts-add swts-icon-plus")},p=function(t,e){return"function"==typeof t&&(e=t,t=o),new r("remove",t,e).addClass("swts-remove swts-icon-trash")},u=function(t){return'<a href="#/add'+(t?"/"+t:"")+'" class="swts-button swts-add swts-icon-plus"></a>'},c=function(t){return'<a href="#/remove'+(t?"/"+t:"")+'" class="swts-button swts-remove swts-icon-trash"></a>'};i("ui/buttons",{add:l,remove:p,button:a,template:{add:u,remove:c}})}(t,e),function(){var t={"а":"a","б":"b","в":"v","г":"g","д":"d","е":"e","ё":"yo","ж":"zh","з":"z","и":"i","й":"y","к":"k","л":"l","м":"m","н":"n","о":"o","п":"p","р":"r","с":"s","т":"t","у":"u","ф":"f","х":"h","ц":"c","ч":"ch","ш":"sh","щ":"sch","ъ":"","ы":"y","ь":"","э":"e","ю":"yu","я":"ya"},e=function(e){return e.toLowerCase().split("").map(function(e){return t[e]||e}).join("").replace(" ","-").replace(/[^-a-z0-9]{1,60}/,"")};i("ui/input/slugify",e)}(t,e),function(t,e,o){var s=n("$"),r=n("util/inherits"),a=n("ui/bar"),l=n("ui/input/slugify"),p=function(t,e,n){var i=this;t instanceof s||t===o||(n=e,e=t,t=o),e||(e={}),i.$b=t||s('<label class="swts-input"><input type="'+(e.type||"text")+'" '+(e.value?'value="'+e.value+'"':"")+"><span>"+e.title+"</span></label>").on("click.input",function(t){t.stopPropagation()}),i.$i=i.$b.find("input").on("blur.input",function(){""!==this.value?i.$b.addClass("swts-input-val"):i.$b.removeClass("swts-input-val")}).trigger("blur").on("keyup.input",function(){i.transform&&(this.value=i.transform(this.value)),i.throttledUpdate(this.value)}),i.value=e.value,i.rx=e.rx,e.slugify?(i.slugify=!0,i.transform=l):e.transform&&(i.transform=e.transform),i.err=e.errorClass||"swts-error",i.cb=n,e.onPaste&&i.$i.on("paste",e.onPaste)};r(p,a),p.prototype.val=function(t,e){return t===o?this.$i.val():(this.$i.val(t).trigger("blur"),this.throttledUpdate(t,e),this)},p.prototype.focus=function(){this.$i.focus()},p.prototype.throttledUpdate=function(t,e){var o=this;clearTimeout(o.typingTimer),o.typingTimer=setTimeout(function(){t!==o.value&&(o.rx?o.rx.test(t)?o.update(t,e):o.$b.addClass(o.err):o.update(t,e))},300)},p.prototype.update=function(t,e){var o=this;o.$b.removeClass(o.err),o.value=t,!e&&o.cb&&o.cb(t)},p.prototype.remove=function(){this.$i.off(".input"),this.$i=o,p.super_.prototype.remove.call(this,".input")},i("ui/input",p)}(t,e),function(){var t=(n("$"),n("ui/input"));i("ui/nipple/input",function(e,o,n){return new t(o,n)})}(t,e),function(t,e,o){var s=n("$"),r=function(t,e){var n=this,i=0,r="";for(var a in e)if("item"!==a){var l=e[a];i++,r+='<a href="#/'+(l.confirm?"confirm/":"")+a+'" class="'+l.icon+'" '+(l.title?'title="'+l.title+'"':"")+"></a>"}n.active=o,n.confirm=o,n.$b=s(r).hover(function(){n.active=this.hash.split("/")[1],n.$parent.addClass("nipple-h-"+n.active),n.$b.not(this).addClass("nipple-hidden")},function(){n.$parent.removeClass("nipple-h-"+n.active),n.$b.removeClass("nipple-hidden")}),setTimeout(function(){n.$parent=n.$b.first().parent().addClass("nipple-i-tools-"+i).on("mouseout.nipple-confirm",function(){n.hideConfirm()}).on("click.nipple-confirm","a",function(t){n.confirm&&n.$parent.hasClass("nipple-confirmation")?setTimeout(function(){n.hideConfirm()},0):"#/confirm"===this.hash.substring(0,9)&&(t.preventDefault(),t.stopPropagation(),n.showConfirm(this))})},0)};r.prototype={showConfirm:function(t){this.$confirm=s(t),this.$parent.addClass("nipple-confirmation"),this.confirm=this.$confirm.attr("href").slice(9),this.$confirm.attr("href","#"+this.confirm)},hideConfirm:function(){this.confirm&&(this.$confirm.attr("href","#/confirm"+this.confirm),this.$parent.removeClass("nipple-confirmation"),this.confirm=o)},remove:function(){this.$parent.off(".nipple-confirm")}},i("ui/nipple/tools",function(t,e){return new r(t,e)})}(t,e),function(t,e,o){var s,r,a=n("$"),l=n("util/inherits"),p=n("ui/bar");a(e).on("click.nipple",function(){s&&s.hide()});var u={input:n("ui/nipple/input"),tools:n("ui/nipple/tools"),item:function(t,e){return{$b:a('<a href="#/'+t+'">'+e.title+"</a>")}}},c=function(t,e){var n=this;e===o&&(e=t,t={}),n._popup=t.popup||r.popup||"s",n.autoHide=t.autoHide||r.autoHide,n.menu=t.menu||r.menu,n.cbs=e,n.items={},n.active=!1,n.build(t.items||r.items,t.size||r.size||"small")};l(c,p),c.prototype.build=function(t,e){var o=this,n=o.cbs,i=a('<ul class="nipple-items"></ul>').on("click.nipple","a",function(t){t.preventDefault(),t.stopPropagation();var e=this.hash.split("/");o.autoHide&&o.hide(),!o.menu&&a(this).parent().hasClass("nipple-i-item")&&o.val(this.hash.slice(2)),n[e[1]]&&n[e[1]].apply(o,e.slice(2))});for(var s in t){var r,l=t[s],p=l.item||"item",c=a('<li class="nipple-i-'+p+'"></li>');r=u[p](s,t[s],n[s]&&n[s].bind(o)),c.append(r.$b),i.append(c),o.items[s]=r}o.$b=a('<div class="nipple nipple-'+e+" nipple-"+o._popup+'"><a href="#nipple-open"></a></div>').append(i),o.$a=o.$b.children("a").on("click.nipple",function(t){t.preventDefault(),t.stopPropagation(),o.toggle()}),o.$items=o.$b.find(".nipple-i-item")},c.prototype.val=function(t){return t===o?this._val:(this._val!==t&&(this.menu||this.$items.find('[href="#/'+this._val+'"]').parent().removeClass("nipple-selected").end().end().find('[href="#/'+t+'"]').parent().addClass("nipple-selected"),this._val=t),this)},c.prototype.direction=function(t){return t===o?this._popup:(this._popup!==t&&(this.$b.removeClass("nipple-"+this._popup).addClass("nipple-"+t),this._popup=t),this)},c.prototype.confirm=function(t){var e=this;e.confirmTool!==t?e.$confirm.attr("href","#/confirm/"+t).addClass("nipple-hot"):(e.cbs[t].apply(e,arguments.slice(1)),e.hideConfirm())},c.prototype.hideConfirm=function(){this.confirmTool=o,this.$confirm.removeClass("nipple-hot")},c.prototype.toggle=function(){this.active?this.hide():this.show()},c.prototype.show=function(){return s&&s.hide(),s=this,this.$b.addClass("nipple-hot"),this.active=!0,this},c.prototype.hide=function(){return s=o,this.$b.removeClass("nipple-hot"),this.active=!1,this},c.prototype.remove=function(){this.$a.off(".nipple"),this.$a=o,c.super_.prototype.remove.call(this)},c.defaults=function(t){r=t},i("ui/nipple",c)}(t,e),function(t,e,o){var s=n("$"),r=s(t),a=n("swts"),l=n("util/inherits"),p=n("ui/bar"),u=n("ui/nipple"),c=n("ui/input"),d='<div class="swts-cover-login"><label class="swts-input" id="swts-cover-email"><input type="text"><span>Email</span></label><label class="swts-input" id="swts-cover-password"><input type="password"><span>Password</span></label><a href="#/login" class="swts-button-m">Go</a></div>',f=function(t){var e=this;t||(t={}),e.$parent=s(t.parent||"body"),e.isLoginVisible=!1,e.editing=!1,e.popup=t.popup||"n",e.ui={},a.u?e.showUser(a.u):e.buildLogin()};l(f,p),f.prototype.load=function(){var o=this,n=e.createElement("script");i("swts",a,!0),n.src="/static/js/chocolate.js",n.onload=function(){t.Chocolate&&(o.choco=new t.Chocolate(a),o.choco.on(),o.edit())},e.body.appendChild(n)},f.prototype.buildLogin=function(){var t=this;t.$l=s(d).appendTo(t.$parent).on("click.swts.login",function(t){t.stopPropagation()}).on("keypress.swts.login",function(e){13===e.keyCode&&t.login()}).find(".swts-button-m").on("click.swts.login",function(e){e.preventDefault(),t.login()}).end(),t.ui.login=new c(t.$l.find("#swts-cover-email")),t.ui.password=new c(t.$l.find("#swts-cover-password")),r.on({"keydown.swts.login":function(e){t.isLoginVisible?27===e.keyCode&&(e.preventDefault(),t.hideLogin()):e.shiftKey&&48===e.keyCode&&(e.preventDefault(),t.showLogin())},"click.swts.login":function(){t.isLoginVisible&&t.hideLogin()}})},f.prototype.showLogin=function(){this.isLoginVisible=!0,this.$l.addClass("active"),this.ui.login.focus()},f.prototype.hideLogin=function(){this.$l.removeClass("active"),this.ui.login.val(""),this.ui.password.val(""),this.isLoginVisible=!1},f.prototype.removeLogin=function(){var t=this;t.hideLogin(),r.off(".swts.login"),setTimeout(function(){t.$l.remove(),t.ui.login=o,t.ui.password=o},650)},f.prototype.login=function(){var t=this,e=t.ui;a.userLogin(e.login.val(),e.password.val(),function(e,o){e?t.error():(t.removeLogin(),t.showUser(o))})},f.prototype.error=function(){var t=this;t.$l.addClass("swts-error"),setTimeout(function(){t.$l.removeClass("swts-error")},500)},f.prototype.showUser=function(t){if(t){var e=this;e.ui.user=new u({popup:e.popup,size:"medium",menu:!0,autoHide:!0,items:{edit:{title:"Edit"},profile:{title:t.name||t.id},logout:{title:"Logout"}}},{edit:e.edit.bind(e),logout:e.logout.bind(e),profile:function(){console.log("User profile")}}).addClass("swts-user").appendTo(e.$parent)}},f.prototype.edit=function(){var t=this,e=t.ui.user;t.choco?t.editing?(t.editing=!1,t.choco.off(),e.removeClass("swts-editing").items.edit.$b.text("Edit")):(t.choco.on(),e.addClass("swts-editing").items.edit.$b.text("Stop editing"),t.editing=!0):t.load()},f.prototype.logout=function(){a.userLogout(),this.ui.user.remove(),this.ui={},this.buildLogin()},i("ui/cover",f)}(t,e),function(t,e,o){var s=n("$"),r=n("util/inherits"),a=n("ui/bar"),l=/(\/)/g,p=function(t,e,o){var n=this;"function"==typeof e&&(o=e,e={}),n.keepOrder=e.keepOrder,n.isMultiple=e.multiple,n.selected=e.selected||(n.isMultiple?[]:""),n.cb=o,n.items=t,n.order=[],n.build()};r(p,a),p.prototype.parse=function(){return this},p.prototype.buildItems=function(t){for(var e=this,o="",n=e.selected,i=n&&n.length,s=0,r=t.length;r>s;s++){var a="",p=t[s],u=Object.keys(p)[0];e.order.push(u),i?(u===n||e.isMultiple&&-1!==n.indexOf(u))&&(a=" selectah-active"):0===s&&(a=" selectah-active");var c=u.match(l);o+='<li class="selectah-level-'+(c?c.length:0)+a+'"><a href="#:'+u+'">'+p[u]+"</a></li>"}return o},p.prototype.build=function(){var t=this,e='<ul class="selectah">';e+=t.buildItems(t.items),e+="</ul>",t.$b=s(e).on("click.selectah","a",function(e){e.preventDefault(),e.stopPropagation(),t.check(this)}),t.$li=t.$b.find("li")},p.prototype.pushInOrder=function(t){var e=this,o=e.order,n=e.selected;for(t=t.split("/");t.length;){var i=t.join("/");n.push(i),this.$b.find('a[href="#:'+i+'"]').parent().addClass("selectah-active"),t.pop()}e.selected=[];for(var s in o)-1!==n.indexOf(o[s])&&e.selected.push(o[s])},p.prototype.set=function(t){var e=this;return e.selected=t,e.$b.addClass("no-transition"),e.$li.removeClass("selectah-active"),e.$b.find('a[href="#:'+t+'"]').parent().addClass("selectah-active"),setTimeout(function(){e.$b.removeClass("no-transition")},10),this},p.prototype.val=function(t){return t===o?this.selected:(this.check(this.$b.find('a[href="#:'+t+'"]')[0]),this)},p.prototype.check=function(t){var e=this,o=t.hash.split(":")[1],n=s(t).parent();n.hasClass("selectah-active")?e.deactivate(n,o):e.activate(n,o)},p.prototype.activate=function(t,e){var o=this;o.isMultiple?o.keepOrder?o.pushInOrder(e):o.selected.push(e):(o.$li.removeClass("selectah-active"),o.selected=e),t.addClass("selectah-active"),o.cb&&o.cb(o.selected)},p.prototype.deactivate=function(t,e){var o=this;if(o.isMultiple&&o.selected.length>1){t.removeClass("selectah-active");for(var n=0;n<o.selected.length;n++)if(o.selected[n]===e){o.selected.splice(n,1);break}o.cb&&o.cb(o.selected)}},p.prototype.show=function(){return this.$b.show(),this},p.prototype.remove=function(){p.super_.prototype.remove.call(this,".selectah")},i("ui/selectah",p)}(t,e),function(t,e,o){var s=n("$"),r=n("util/inherits"),a=n("ui/bar"),l=[31,28,31,30,31,30,31,31,30,31,30,31],p={startDay:"MON",messages:{year:"",months:{0:{s:"Jan",f:"January"},1:{s:"Feb",f:"February"},2:{s:"Mar",f:"March"},3:{s:"Apr",f:"April"},4:{s:"May",f:"May"},5:{s:"Jun",f:"June"},6:{s:"Jul",f:"July"},7:{s:"Aug",f:"August"},8:{s:"Sep",f:"September"},9:{s:"Oct",f:"October"},10:{s:"Nov",f:"November"},11:{s:"Dec",f:"December"}}}},u=function(t,e){"function"==typeof t&&(e=t,t={});var o=this;o.$b=s("<div class='gregory'></div>"),o.modes={day:"day",month:"month",year:"year"},o.displayState={},o.selectedState={},o.prevFullState={},o.weekStartDay=t.weekStartDay||p.startDay,o.messages=t.messages||p.messages,o.flip=t.flip,o.cb=e,o.build(t.popup),o.prevFullState.mode=o.modes.day};r(u,a),u.prototype.build=function(t){var e=this,o=e.flip,n='<div class="gregory-header"><a class="gregory-change gregory-back" href="#"></a><a class="gregory-info" href="#/"></a><a class="gregory-change gregory-forward" href="#"></a></div>',i='<div class="gregory'+(t?" gregory-popup":"")+(o?" gregory-up":" gregory-down")+'">';o||(i+=n),i+='<div class="gregory-wrapper"></div>',o&&(i+=n),i+="</div>",e.$b=s(i).on("click.gregory",function(t){t.stopPropagation()}).on("click.gregory","a.gregory-change",function(t){t.preventDefault();var o=this.hash.split("/"),n=parseInt(o[1],10),i=o[2]?parseInt(o[2],10):null,s={};s.year=n,(0===i||i)&&(s.month=i),e.changeState(s,"dateChange")}),e.$wrapper=e.$b.find(".gregory-wrapper").on("click.gregory","a",function(t){t.preventDefault();var o=s(this),n=this.hash.split("/"),i=parseInt(n[1],10),r=n[2]?parseInt(n[2],10):null,a=n[3]?parseInt(n[3],10):null;e.changeSelectedState({year:i,month:r,day:a},o),e.cb&&e.cb(new Date(i,r,a),!!a)}),e.$date=e.$b.find(".gregory-info").on("click.gregory",function(t){t.preventDefault();var o={};o.mode=this.hash.split("/")[1],o.mode===e.modes.day?e.changeSelectedState(e.prevFullState):(o.month=null===e.displayState.month?e.selectedState.month:e.displayState.month,e.isYearActive(e.displayState.year)||e.displayState.mode!==e.modes.month||(o.year=e.selectedState.year),e.changeState(o))}),e.$back=e.$b.find(".gregory-back"),e.$forward=e.$b.find(".gregory-forward")},u.prototype.val=function(t){if(t===o){var e=this.selectedState;return new Date(e.year,e.month,e.day)}var n;return n=t instanceof Date?{year:t.getFullYear(),month:t.getMonth(),day:t.getDate()}:t,n.mode=n.day?this.modes.day:this.modes.month,this.changeState(n),this.changeSelectedState(n),this},u.prototype.changeState=function(t){var e=this;e.setState(t),e.buildCalendar(),e.updateInfo()},u.prototype.changeSelectedState=function(t,e){var o=this;if(o.displayState.mode===o.modes.day){if(o.$wrapper.find(".gregory-active").removeClass("gregory-active"),!e){var n="a[href='#/"+t.year+(0===t.month||t.month?"/"+t.month+(t.day?"/"+t.day:""):"")+"']";e=o.$wrapper.find(n)}e.addClass("gregory-active")}o.setSelected(t),o.updatePrevFullState(),t.mode||(o.displayState.mode===o.modes.year?t.mode=o.modes.month:o.displayState.mode===o.modes.month&&(t.mode=o.modes.day)),o.changeState(t)},u.prototype.buildCalendar=function(){var t=this;t.displayState.mode===t.modes.day?t.buildDays():t.displayState.mode===t.modes.month?t.buildMonths():t.buildYears()},u.prototype.buildDays=function(){var t=this,e=new Date(t.displayState.year,t.displayState.month,1).getDay(),o=t.getDaysInMonth(t.displayState.year,t.displayState.month),n="MON"===t.weekStartDay?0===e?6:e-1:e,i='<ul class="gregory-day">',s=1,r=t.prevMonth(t.displayState.year,t.displayState.month),a=t.nextMonth(t.displayState.year,t.displayState.month);t.setChange(r.year+"/"+r.month,a.year+"/"+a.month);for(var l=0;9>l;l++){for(var p=0;6>=p;p++)if(o>=s&&(p>=n&&0===l||l>0))i+="<li><a class='"+(t.isDayActive(s)?"gregory-active":"")+"' href='#/"+t.displayState.year+"/"+t.displayState.month+"/"+s+"'>"+s+"</a></li>",s++;else{if(s>o)break;i+="<li></li>"}if(s>o)break}i+="</ul>",t.$wrapper.html(i)},u.prototype.buildMonths=function(){var t=this,e='<ul class="gregory-month">',o=0;t.setChange(t.displayState.year-1,t.displayState.year+1);for(var n=0;4>n;n++){for(var i=0;2>=i;i++)e+="<li><a class='"+(t.isMonthActive(o)?"gregory-active'":"")+"' href='#/"+t.displayState.year+"/"+o+"'>"+t.messages.months[o].s+"</a></li>",o++;if(o>11)break}e+="</ul>",t.$wrapper.html(e)},u.prototype.buildYears=function(){var t=this,e='<ul class="gregory-year">',o=t.displayState.twelfth-11;t.setChange(o-1,t.displayState.twelfth+12);for(var n=0;4>n;n++){for(var i=0;2>=i;i++)e+="<li><a class='"+(t.isYearActive(o)?"gregory-active'":"")+"' href='#/"+o+"'>"+o+"</a></li>",o++;if(o>t.displayState.twelfth)break}e+="</ul>",t.$wrapper.html(e)},u.prototype.setChange=function(t,e){var o=this;o.$back.attr("href","#/"+t),o.$forward.attr("href","#/"+e)},u.prototype.setDateActive=function(){var t=this;t.$wrapper.find("a[href='#/"+t.formUrl+"']").addClass("gregory-active")},u.prototype.prevMonth=function(t,e){var o={};return 0===e?(o.year=t-1,o.month=11):(o.year=t,o.month=e-1),o},u.prototype.nextMonth=function(t,e){var o={};return 11===e?(o.year=t+1,o.month=0):(o.year=t,o.month=e+1),o},u.prototype.getDaysInMonth=function(){var t=this;return 1===t.displayState.month&&(t.displayState.year%4===0&&t.displayState.year%100!==0||t.displayState.year%400===0)?29:l[t.displayState.month]},u.prototype.updateInfo=function(){var t,e=this,o=e.displayState;e.$date.html(o.mode===e.modes.day?e.messages.months[o.month].f+" "+o.year:o.mode===e.modes.month?o.year+" "+e.messages.year:e.prevFullState.day+"."+(e.prevFullState.month+1)+"."+e.prevFullState.year),o.mode===e.modes.day?t=e.modes.month:o.mode===e.modes.month?t=e.modes.year:o.mode===e.modes.year&&(t=e.modes.day),e.$date.attr("href","#/"+t)},u.prototype.setState=function(t){var e=this,o=e.displayState;t.year&&(o.year=t.year,o.twelfth=t.year),o.month=0===t.month||t.month?t.month:null,t.mode&&(o.mode=t.mode),o.mode||(o.mode=0===t.month||t.month?e.modes.day:e.modes.month)},u.prototype.setSelected=function(t){var e=this.selectedState;e.year=t.year,e.month=t.month,e.day=t.day?t.day:null},u.prototype.updatePrevFullState=function(){var t=this.selectedState,e=this.prevFullState;t.day&&(t.month||0===t.month)&&t.year&&(e.day=t.day,e.month=t.month,e.year=t.year)},u.prototype.isDayActive=function(t){return t===this.selectedState.day&&this.displayState.month===this.selectedState.month&&this.displayState.year===this.selectedState.year},u.prototype.isMonthActive=function(t){return t===this.selectedState.month&&this.displayState.year===this.selectedState.year},u.prototype.isYearActive=function(t){return t===this.selectedState.year},u.prototype.show=function(){return this.$b.addClass("gregory-hot"),this},u.prototype.hide=function(){return this.$b.removeClass("gregory-hot"),this},u.prototype.toggle=function(){return this.$b.toggleClass("gregory-hot"),this},u.prototype.remove=function(){var t=this;t.$b.off(".gregory"),t.$b.remove(),t.$b=o,t.$wrapper.off(".gregory"),t.$wrapper=o,t.$date.off(".gregory"),t.$date=o,t.$back=o,t.$forward=o},u.defaults=function(t){p=t},i("ui/gregory",u)}(t,e),function(t,e,o){var s,r=n("$"),a=n("util/inherits"),l=n("ui/input"),p=n("ui/gregory"),u=r(e),c=/^\d{1,2}.\d{1,2}.\d{4}$/,d=function(t,e,n){var i=this;t instanceof r||(n=e,e=t,t=o),e||(e={}),e.rx||(e.rx=c),e.type="text",l.call(i,t,e),i.flip=e.flip,i.cb=n,this.active=!1,i.gregory=new p({flip:i.flip,popup:!0},function(t,e){e&&i.update(t)}).appendTo(i.$b),i.$i.on("click.input",function(){i.toggle()}),u.on("click.input",function(){i.active&&i.hide()});var s=parseInt(i.$i.val(),10);i.value=o,s===s?i.update(s,!0):i.gregory.val(new Date)};a(d,l),d.prototype.val2date=function(t){var e;switch(typeof t){case"number":e=new Date(t);break;case"string":t=t.split("."),e=new Date(t[2],t[1]-1,t[0]);break;default:e=t}return e&&"Invalid Date"===e.toString()?o:e},d.prototype.show=function(){return s&&s.hide(),s=this.gregory.show(),this.active=!0,this},d.prototype.hide=function(){return s=o,this.gregory.hide(),this.active=!1,this},d.prototype.toggle=function(){this.active?this.hide():this.show()},d.prototype.formatDate=function(t){return t.getDate()+"."+(t.getMonth()+1)+"."+t.getFullYear()},d.prototype.val=function(t){return t===o?this.value:(this.update(t),this)},d.prototype.update=function(t,e){var n=this,i=function(t){n.$b.removeClass(n.err),n.gregory.val(t),n.value=n.gregory.val(),n.$i.val(n.formatDate(t)).trigger("blur"),!e&&n.cb&&n.cb(t)};t=n.val2date(t),n.value===o&&t?i(t):t&&n.value.getTime()!==t.getTime()&&i(t)},d.prototype.remove=function(){var t=this;s===this.gregory&&(s=o),t.gregory.remove(),t.$i.off(".input"),t.$b.off(".input").remove(),t.$b=o,t.$i=o},i("ui/gregory/dateinput",d)}(t,e),function(t,e){var o=n("$"),s=(o(t),o("body")),r=[],a=/<[^>]*>/gi,l=function(){for(var t in r)r[t].addClass("gutenberg-hidden")},p=function(t){for(var e in r)t===r[e]&&r.splice(e,1)},u=function(){var o;if(t.getSelection){var n=t.getSelection();n.rangeCount&&(o=n.getRangeAt(0))}else e.selection&&e.selection.createRange&&(o=e.selection.createRange());return o},c=function(t){var o=u(),n=e.createElement(t);o.surroundContents(n)},d={orderedList:{icon:"swts-icon-ol",command:function(){}},bold:{icon:"swts-icon-bold",command:function(t){c("strong"),t.onTextEdit(t.$b.html())}},italic:{icon:"swts-icon-italic",command:function(t){c("em"),t.onTextEdit(t.$b.html())}},removeFormat:{icon:"swts-icon-clean",command:function(t){e.execCommand("removeFormat"),t.onTextEdit(t.$b.html())}},link:{icon:"swts-icon-link",iconUnlink:"swts-icon-unlink",additionalInit:function(n){n.selectionIsLink=function(){var e=!1,o=t.getSelection();return(navigator.userAgent.match(/webkit/i)?0:1)?(navigator.userAgent.match(/firefox/i)?0:1)||(e=n.firefoxSelectionIsLink()):e=n.findNodeWithTags(o.focusNode,"A"),e},n.firefoxSelectionIsLink=function(){var e=t.getSelection(),o=n.getRange(),i=o.cloneContents();return 1===i.childNodes.length&&"A"===i.firstChild.tagName?!0:n.findNodeWithTags(e.focusNode,"A")},n.findNodeWithTags=function(t,e){for(o.isArray(e)||(e=[e]);t;){if(3!==t.nodeType){var n=e.indexOf(t.tagName);if(-1!==n)return t}t=t.parentNode}return null},n.buildLink=function(){n.$link=n.$controlsWrapper.find("a.swts-icon-link"),n.$linkWrapper=o('<li class="gutenberg-hidden"><input type="text" placeholder="Type link here"/></li>'),n.$linkInput=n.$linkWrapper.find("input"),n.$link.parent().parent().append(n.$linkWrapper)},n.initLinkListeners=function(){n.$linkInput.on("keypress",function(t){13===t.which&&n.onLinkEnter()}),n.$b.on("mousedown.gutenberg",function(){n.hide(n.$linkWrapper,!0),o(e).one("mousedown.gutenberg",function(){n.hide(n.$linkWrapper,!0)}).one("mouseup.gutenberg",function(){n.clicked&&n.selectionIsLink()?n.$link.removeClass("swts-icon-link").addClass("swts-icon-unlink"):n.clicked&&!n.selectionIsLink()&&n.$link.removeClass("swts-icon-unlink").addClass("swts-icon-link")})})},n.onLinkEnter=function(){var o=t.getSelection();n.$linkInput.blur(),o.removeAllRanges(),o.addRange(n.$linkInput.data("selection")),e.execCommand("createlink",!1,n.$linkInput.val()),n.hide(n.$linkWrapper,!0),n.$link.removeClass("swts-icon-link").addClass("swts-icon-unlink"),n.onTextEdit(n.$b.html())},n.buildLink(),n.initLinkListeners()},command:function(o){o.selectionIsLink()?(e.execCommand("unlink"),o.$link.removeClass("swts-icon-unlink").addClass("swts-icon-link"),o.onTextEdit(o.$b.html())):(o.$linkInput.data("selection",t.getSelection().getRangeAt(0)),o.hide(o.$linkWrapper,!1),o.$linkInput.focus())}}},f=function(t,e,n){var i=this;"function"==typeof e&&(n=e,e={}),i.$b=o(t),i.initialVal=i.$b.html(),i.curVal,i.commands=e.commands,i.onChange=n,i.onChangeDelay=e.onChangeDelay||500,i.stopLinks=e.stopLinks,i.allowNewLine=e.allowNewLine,i.allowTags=i.allowNewLine?!0:e.allowTags,i.typingTimer,i.$b.attr("contenteditable",!0),i.buildDOM(),i.initListeners()};f.prototype.buildDOM=function(){var t,e=this;if(e.commands){e.$controlsWrapper=o('<ul class="gutenberg-ctrl gutenberg-hidden">');for(var n in e.commands){var i=e.commands[n],a=d[i];a&&(t='<li><a href="#'+i+'" class="'+a.icon+'"></a></li>',e.$controlsWrapper.append(t),a.additionalInit&&a.additionalInit(e))}e.$links=e.$controlsWrapper.find("a"),r.push(e.$controlsWrapper),s.append(e.$controlsWrapper)}},f.prototype.initListeners=function(){var t=this;t.$b.on("paste.gutenberg",function(e){t.onPaste(this,e)}).on("keydown.gutenberg",function(e){switch(e.which){case 8:setTimeout(function(){t.sanitizeBackspace()},0);break;case 13:!t.allowNewLine&&e.preventDefault();break;case 27:t.restoreText()}}).on("keyup.gutenberg",function(){t.onTextEdit(t.$b.html())}).on("mousedown.gutenberg",function(n){t.clicked=!0,n.stopPropagation(),l(),o(e).one("mousedown.gutenberg",function(){l()}).one("mouseup.gutenberg",function(e){t.onTextSelect(e)})}).on("focus.gutenberg",function(){t.curVal=t.$b.html()}),t.stopLinks&&t.$b.on("click",function(t){t.preventDefault(),t.stopPropagation()}),t.$controlsWrapper&&(t.$controlsWrapper.on("mousedown.gutenberg",function(t){t.stopPropagation()}).on("mouseup.gutenberg",function(t){t.stopPropagation()}),t.$controlsWrapper.on("click.gutenberg","a",function(e){e.preventDefault(),t.onToolClick(this.href.split("#")[1])}))},f.prototype.onPaste=function(t,o){e.execCommand("insertText",!1,o.originalEvent.clipboardData.getData("text/plain")),o.preventDefault(),o.stopPropagation(),this.onTextEdit(this.$b.html())},f.prototype.sanitizeBackspace=function(){this.$b.find("span").each(function(){this.style&&o(this).contents().unwrap()})},f.prototype.onTextSelect=function(t){var e=this,o=e.getRange();if(e.$controlsWrapper&&o.startOffset!==o.endOffset&&e.clicked){if(e.prevStartOffset===o.startOffset&&e.prevEndOffset===o.endOffset)return void e.hide(e.$controlsWrapper,!0);e.hide(e.$controlsWrapper,!1);var n=e.getSelectionPosition(t);e.$controlsWrapper.css({left:n.left,top:n.top}),e.clicked=!0,e.prevStartOffset=o.startOffset,e.prevEndOffset=o.endOffset}},f.prototype.onToolClick=function(t){d[t].command(this)},f.prototype.onTextEdit=function(t){var e=this;clearTimeout(e.typingTimer),e.typingTimer=setTimeout(function(){e.updateContent(t)},e.onChangeDelay)},f.prototype.updateContent=function(t){this.allowTags||(t=t.replace(a,"")),this.curVal!==t&&(this.onChange(t),this.curVal=t)},f.prototype.restoreText=function(){this.$b.html(this.initialVal),this.onTextEdit(this.initialVal)},f.prototype.val=function(t){this.$b.html(t)},f.prototype.getRange=function(){if(t.getSelection){var o=t.getSelection();if(o.rangeCount>0)return o.getRangeAt(0)}else if(e.selection&&e.selection.createRange)return e.selection.createRange();return null},f.prototype.getSelectionPosition=function(t){var o=this,n=o.getRange().getBoundingClientRect(),i=t.pageX-o.$controlsWrapper.width()/2,s=e.body.scrollTop||e.documentElement.scrollTop;0>i&&(i=10);var r=s+n.top-o.$controlsWrapper.height()-10;return{left:i,top:r}},f.prototype.remove=function(){var t=this;t.$b.off(".gutenberg"),t.$b.attr("contenteditable",!1),t.$controlsWrapper&&t.$controlsWrapper.remove(),p(t.$controlsWrapper)},f.prototype.hide=function(t,e){e?t.addClass("gutenberg-hidden"):t.removeClass("gutenberg-hidden")},i("ui/gutenberg",f)}(t,e),function(t,e,o){var s,r=n("$"),a=n("swts"),l=function(t,e,n){var i=this;i.$b=r(t),i.$progress=r('<div class="swts-upload-progress"></div>'),i.delay=n.progressDelay||500,i.resource=e,i.start=n.start,i.done=n.done,i.progress=n.progress,i.maxFiles=n.maxFiles||1,i.$b.on({"dragover.upload":function(){return s&&s.removeClass("swts-upload-drop"),s=i.$b.addClass("swts-upload-drop"),!1},"drop.upload":function(t){t.preventDefault(),i.$b.removeClass("swts-upload-drop"),s=o;var e=t.originalEvent.dataTransfer.files;e.length&&e.length<=i.maxFiles&&i.upload(e,t.target)},"mouseout.upload":function(){i.$b.removeClass("swts-upload-drop"),s=o}})};l.prototype.upload=function(t,e){var o=this,n={resource:"file",method:"create",body:{resource:o.resource},files:t,onprogress:function(t){var e=t.loaded/t.total*100;o.$progress.css("width",e+"%"),o.progress&&o.progress(t,e)}};o.$b.append(o.$progress),o.startTimeout=setTimeout(function(){o.$progress.addClass("uploading")},o.delay),o.start&&o.start(),a.c(n,function(t,n){clearTimeout(o.startTimeout),o.$progress.removeClass("uploading"),setTimeout(function(){o.$progress.detach()},o.delay),o.done(t,n,e)})},l.prototype.remove=function(){this.$b.off(".upload"),this.$progress.remove(),this.$progress=o,this.$b=o},i("ui/upload",l)}(t,e),function(t,e){var o=n("$"),i=n("ui/buttons"),s=n("ui/nipple"),r=n("ui/input"),a=n("ui/cover"),l=n("ui/selectah"),p=n("ui/gregory"),u=n("ui/gregory/dateinput"),c=n("ui/gutenberg"),d=n("ui/upload");o(e).ready(function(){s.defaults({items:{tools:{item:"tools",options:{title:"Options",icon:"swts-icon-dots"},remove:{confirm:!0,title:"Удалить",icon:"swts-icon-trash"}},"status/draft":{title:"Draft"},"status/published":{title:"Published"}}});{var t=(i.add("id",function(t){console.log("add button",t)}).appendTo("#simple-buttons"),i.remove("id",function(t){console.log("remove button",t)}).appendTo("#simple-buttons"),new r({title:"Title"},function(t){console.log("Input",t)}).appendTo("#input-fields"),new r({title:"Slug",slugify:!0},function(t){console.log("Slug",t)}).appendTo("#input-fields"),/^\d{2,20}$/),e=/^https?:\/\/(?:www\.)?vimeo.com\/(\d+)($|\/)/;new r({title:"Vimeo id",rx:t,onPaste:function(){var t=this;setTimeout(function(){var o=t.value.match(e);o&&(t.value=o[1])},32)}},function(t){console.log("Vimeo Id",t)}).appendTo("#input-fields"),new a("body"),new s({popup:"e",size:"medium",menu:!0,autoHide:!0,items:{edit:{title:"Edit"},profile:{title:"Username"},logout:{title:"Logout"}}},{edit:function(){console.log("Edit mode")},profile:function(){console.log("User profile")},logout:function(){console.log("Logout")}}).addClass("swts-user").appendTo("#nipple"),new s({status:function(t){console.log("Nipple status",t),this.removeClass("draft published").addClass(t)},remove:function(){console.log("Nipple remove")},options:function(){console.log("Nipple options")}}).val("status/draft").addClass("draft").appendTo("#nipple"),new s({popup:"n",items:{slug:{item:"input",title:"Slug",slugify:!0},title:{item:"input",title:"Title",value:"Item title"}}},{slug:function(t){console.log("slug",t)},title:function(t){console.log("title",t)}}).addClass("swts-options").appendTo("#nipple"),new l([{draft:"Draft"},{ready:"Ready"},{published:"Published"}],function(t){console.log("Selectah",t)}).addClass("simple").appendTo("#selectah"),new l([{app:"Application"},{code:"Code"},{design:"Design"},{photography:"Photography"},{web:"Web"}],{multiple:!0,keepOrder:!0,selected:["app","design"]},function(t){console.log("Selectah",t)
}).addClass("multi").appendTo("#selectah"),new p(function(t){console.log("Gregory",t)}).val(new Date).appendTo("#gregory"),new u({title:"Publication date"},function(t){console.log("Date input",t)}).appendTo("#dateinput"),new c("#gutenberg > p",{tools:["bold","italic","orderedList"]},function(t){console.log("Gutenberg",t)}),new d("#upload","sponsor",{maxFiles:1,start:function(){console.log("Upload start")},progress:function(t,e){console.log("Upload progress",e)},done:function(t,e,o){console.log("Upload done",t,e,o)}})}})}(t,e)}(window,document);